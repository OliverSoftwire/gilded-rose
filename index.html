<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<title>Gilded Rose</title>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
		<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css">

		<style>
			body {
				padding: 15px;
			}

			.delete {
				font-size: large;
				color: var(--bs-danger);
			}

			.disabled {
				pointer-events: none;
				color: darkgray;
			}
		</style>
	</head>
	<body>
		<h1 id="table-header">Shop Items</h1>
		<table id="table" data-toggle="table"></table>

		<div class="mt-2">
			<div class="btn-group">
				<button type="button" class="btn btn-success" disabled><i class="bi-plus-lg"></i> New Item</button>
				<button
					type="button"
					class="btn btn-success dropdown-toggle dropdown-toggle-split"
					data-bs-toggle="dropdown"
					aria-haspopup="true"
					aria-expanded="false"
					disabled
				></button>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="#">Action</a>
					<a class="dropdown-item" href="#">Another action</a>
					<a class="dropdown-item" href="#">Something else here</a>
				</div>
			</div>
			<button onclick="nextDay()" type="button" class="btn btn-primary">Next Day</button>
			<button onclick="reset()" id="reset" type="button" class="btn btn-danger">Reset</button>
		</div>

		<script src="gilded_rose.js"></script>

		<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.js"></script>

		<script>
			function disableEditMode() {
				document.getElementById("reset").disabled = false;

				const deleteButtons = document.getElementsByClassName("delete");
				for (let i = 0; i < deleteButtons.length; i++) {
					deleteButtons[i].classList.add("disabled");
				}
			}

			function enableEditMode() {
				document.getElementById("reset").disabled = true;

				const deleteButtons = document.getElementsByClassName("delete");
				for (let i = 0; i < deleteButtons.length; i++) {
					deleteButtons[i].classList.remove("disabled");
				}
			}

			function setTableHeader(newHeader) {
				document.getElementById("table-header").innerText = newHeader;
			}

			const deleteEvents = {
				"click .delete": (e, value, row, index) => {
					$("table").bootstrapTable("remove", {
						field: "$index",
						values: [index]
					});
					console.log("test");
				}
			}

			function initTable() {
				$("#table").bootstrapTable("destroy").bootstrapTable({
					columns: [
						{
							field: "id",
							visible: false
						},
						{
							field: "delete",
							align: "center",
							clickToSelect: false,
							events: deleteEvents,
							formatter: (value, row, index) => `<a class="delete"><i class="bi-trash"></i></a>`
						},

						{
							field: "name",
							title: "Item Name",
							sortable: true
						},
						{
							field: "sellIn",
							title: "Sell In",
							sortable: true
						},
						{
							field: "quality",
							title: "Quality",
							sortable: true
						}
					]
				});
			}

			function updateTable(shop) {
				$("#table").bootstrapTable("load", shop.items);
			}

			const items = [
				new LegendaryItem("Sulfuras, Hand of Ragnaros", 80),
				new BasicItem("Aged Brie", 10, 0, 1),
				new BasicItem("Witchwood Apple", 3, 15),
				new BasicItem("Diving Elixir", 11, 50),
				new BackstagePass("Backstage passes to a TAFKAL80ETC concert", 15, 5),
				new BackstagePass("Backstage passes to a TAFKAL80ETC concert", 25, 5),
				new BackstagePass("Backstage passes to an Ice Cream Boys concert", 25, 5),
				new ConjuredItem("Conjured Wizard Hat", 20, 50),
				new ConjuredItem("Conjured Wizard Robes", 16, 50)
			];

			let shop;
			initTable();
			reset();

			function nextDay() {
				shop.updateQuality();
				shop.printStock();

				setTableHeader(`End of day ${shop.day}`);
				updateTable(shop);

				disableEditMode();
			}

			function reset() {
				shop = new Shop(items);
				shop.printStock();

				setTableHeader(`Shop Items`);
				updateTable(shop);

				enableEditMode();
			}
		</script>
	</body>
</html>
